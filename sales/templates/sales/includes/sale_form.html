{% load widget_tweaks %}
<form id="sale-create-form" method="post" action="{{ action_url }}">{% csrf_token %}
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h5 class="modal-title">{{ modal_title }}</h5>
        </div>
        <div class="modal-body">
            {% for field in form %}
                <div class="form-group{% if field.errors %} has-error{% endif %}">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {% render_field field class="form-control" %}
                    {% for error in field.errors %}
                      <p class="help-block">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger"
                data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add</button>
  </div>

</form>
{% block script %}
    <script>
        var loadProducts = function () {
          var thisControl = $(this);
          var id = parseInt(thisControl.val());
          var productControl = $('#id_product');
           // console.log(typeof(parseInt(id)));
           // console.log(id);
          // console.log(thisControl.text());
               $.get("/sale/get-products/"+id, function (data) {
                   console.log(data);
                   if (data.products.length > 0){   // !!!check for length of options instead
                       // clear options

                       $.each(data.products, function (index, value) {
                            productControl.append("<option value="+value.rate+">"+value.name+"</option>")
                       })
                   }
               });
{#            .attr('value', value.rate).text(value.name)#}
{#            {% url 'sales:get_products' pk=id %}#}
      };
        var calculateAmount = function () {
            var useRate = $(this);
            var units = $('#id_units');
            var amounts = $('#id_amount_paid');
            var product = $('#id_product');
            if(useRate.checked = true){
                var calculated = units*parseInt(product.val());
                amounts.text(calculated);
                amounts.attr('disabled')
            }else{
                amounts.removeAttribute('disabled')
            }
        };
        $('#id_business').change(loadProducts);
        $('#id_default_rate').click(calculateAmount)
    </script>
{% endblock %}